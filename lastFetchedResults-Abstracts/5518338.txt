Inverters with distributed storage(DS) play a very important role in a microgrid. A new kind of inverter called virtual synchronous generator(VSG) is proposed in this paper to emulate the behavior of synchronous generator(SG) in the utility. The core algorithm of VSG is to employ an electromechanical transient mathematic model of round SG. There are two important operation modes in microgrid: active power/reactive power control (PQ control) and voltage/frequency control(Vf control). So a governor and an excitation controller are developed to fulfill these two functions. If Vf control is selected in islanded operation, the objective of governor is to keep frequency in an acceptable range by adjusting the input active power to match the output power. The excitation controller is to maintain the output voltage of VSG by controlling the excitation current; If PQ mode is selected in grid-connected mode, active power could follow the dispatch command very well by the governor. But a Q controller should be developed to control the reactive power by adjusting the voltage reference of excitation controller. Additionally, two kinds of PQ control are discussed here: (1) unit output power flow control (UPC) and (2) feeder power flow control (FFC). Finally, the proposed algorithm and control methods are verified by a single VSG experiment.
