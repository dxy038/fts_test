Coding-aware routing is an effective approach for incorporating network coding into practical network protocols. The main challenge in exploiting the network coding is how coding opportunities can accurately be identified and utilized. In this paper, we formally establish coding conditions for a very general scenario: Multiple coding nodes may exist along a path, and multiple flows may intersect at one node. Specifically, we systematically analyze possible coding scenarios and develop generalized coding conditions to ensure the decoding ability at the destinations. In particular, we develop an extended coding graph to make the conditions implementable. With the help of the extended coding graph, we examine the coding relationship between flows. Our coding conditions also include a coding flow selection procedure to guarantee the coding capability of each coding node, in which not only a native packet, but an encoded packet as well, could be involved. Furthermore we propose a novel coding-aware routing metric, the free-ride-oriented routing metric (FORM), with the objective of exploiting the coding opportunities so that a new flow can free ride on the existing traffic and can be supported with a smaller number of transmissions. NS-2 simulations are conducted to demonstrate the advantage of FORM and the proposed coding conditions over well-known COPE scheme in terms of throughput.
