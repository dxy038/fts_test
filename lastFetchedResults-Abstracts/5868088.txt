This paper studies peer-to-peer networks with the objective of imposing a proportionally fair allocation of peer upload capacity. We begin with a tutorial review on the feasibility of achieving these allocations with idealized assumptions on connectivity and rate control, as well as a distributed algorithm based on peer reciprocity that can achieve it. To impose some of the constraints of real networks (limited number of connections, with bandwidth imposed by lower layers) we introduce an energy function that measures the deviations from ideal reciprocity, and analyze methods to minimize this energy in a decentralized way. To avoid combinatoric difficulties, as well as to enable new peer exploration, we use a Gibbs sampler approach, in which a Markov chain is designed with stationary distribution determined by our energy function. This proposal is implemented and tested in simulation, and results are compared with other existing and proposed P2P exchange systems.
