Anomalies of the omnipresent earth magnetic (i.e., geomagnetic) field in an indoor environment, caused by local disturbances due to construction materials, give rise to noisy direction sensing that hinders any dead reckoning system. In this paper, we turn this unpalatable phenomenon into a favorable one. We present Magicol, an indoor localization and tracking system that embraces the local disturbances of the geomagnetic field. We tackle the low discernibility of the magnetic field by vectorizing consecutive magnetic signals on a per-step basis, and use vectors to shape the particle distribution in the estimation process. Magicol can also incorporate WiFi signals to achieve much improved positioning accuracy for indoor environments with WiFi infrastructure. We perform an in-depth study on the fusion of magnetic and WiFi signals. We design a two-pass bidirectional particle filtering process for maximum accuracy, and propose an on-demand WiFi scan strategy for energy savings. We further propose a compliant-walking method for location database construction that drastically simplifies the site survey effort. We conduct extensive experiments at representative indoor environments, including an office building, an underground parking garage, and a supermarket in which Magicol achieved a 90 percentile localization accuracy of 5 m, 1 m, and 8 m, respectively, using the magnetic field alone. The fusion with WiFi leads to 90 percentile accuracy of 3.5 m for localization and 0.9 m for tracking in the office environment. When using only the magnetism, Magicol consumes 9 &#215; less energy in tracking compared to WiFi-based tracking.
