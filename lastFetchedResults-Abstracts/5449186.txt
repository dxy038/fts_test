In this paper we present power flow optimization of a residential DC microgrid that consists of photovoltaic array, batteries stack and fuel cells stack with electrolyser, and is connected to the grid via bidirectional power converter. The optimization problem aims to minimize microgrid operating costs and is formulated using a linear program that takes into account the storages charge and discharge efficiency. To account for power predictions uncertainty, optimization problem is defined in a stochastic framework by using chance constraints. Since we assume that the error in realization of power predictions will be compensated by utility grid, chance constraints are defined for power exchange between the microgrid and the utility grid. Finally, we investigate a stochastic model predictive control for the closed-loop power management in the microgrid. Performance verification of the proposed approach is performed on simulations for two-month period.
